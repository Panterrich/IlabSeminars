# 4. Документация и Markdown

> _Code comments as a work of art_

Сегодня на семинаре поговорим о различной документации: репозитория и кода.

## README

Репозиторий необходимо оформлять: называть соответствующе, писать описание и конечно писать `README.md`. `README.md` - файл в формате Markdown, отображается при заходе в репозиторий при размещении в корне репозитория.

Хорошо оформленный репозиторий не только помогает привлечь пользователей к вашему проекту, но так же открывает возможность указать проект в своём резюме.

Рассмотрим популярные репозитории, чтобы понять, что обычно указывают в `README.md`:

1. [googletest](https://github.com/google/googletest) - один из самых популярных фреймворков для написания тестов на С/C++.
2. [folly](https://github.com/facebook/folly) - С++ библиотека, написанная в Facebook и состоящая из различных компонент.
3. [json](https://github.com/nlohmann/json) - С++ библиотека для сериализации и десериализации
4. [suricata](https://github.com/OISF/suricata) - IDPS движок с открытым исходным кодом, который часто используют в продуктах класса NGFW.

Основное, что должно фигурировать:
1. Цель проекта и его возможности.
2. Документация по проекту.
3. Примеры использования
4. Способ поставки проекта и сборка.
5. Запуск тестов

Как уже говорилось раннее, `README` пишется с помощью Markdown - это облегченный язык разметки, более интуитивный, чем тот же Latex.

Основной синтаксис приведён [здесь](https://www.markdownguide.org/basic-syntax/). Примеры его использования можно найти в этом репозитории: все семинары написаны в формате Markdown.

## Документация кода

### Комментарии в коде.

Рассмотрим гиперболизированный пример:

```
i++; // add 1 to i
```

Я сам часто видел такие комментарии в коде. Любому человеку, знакомому с С/С++ даже на базовом уровне, и так понятно, что здесь происходит увеличение на единицу. Написанный комментарий не несёт никакой полезной информации и даже вредит, так как загромождает код.

Все комментарии можно разбить на три группы:

1. "Что делаем?"
2. "Как делаем?"
3. "Зачем делаем?"

Рассмотрим их подробнее:

1. "Что?" - худший вариант, который добавляет мало информации к написанному коду. Если такая необходимость возникает, то это обычно значит, что у вас плохой дизайн программы, в само-документируемом коде таких комментариев быть не должно. Единственным осмысленным применением является написание такого комментария перед какой-то сложной конструкцией, однако такую конструкцию обычно можно разбить на более мелкие.
2. "Как?" - средний вариант. Такие комментарии могут быть полезными, так как могут пояснять способ реализации или, обычно, описывать какие-то детали реализации. Например, какой численный метод используется.
3. "Зачем?" - наиболее полезные высокоуровневые комментарии. Они объясняют суть происходящего, не вдаваясь в детали реализации.

Плохой комментарий:

```C++
// Check if value is finite
if (isFinite(value)) { ... }
```

[Хороший комментарий](https://github.com/torvalds/linux/blob/master/include/linux/list.h#L213):

```C
struct list_head {
    struct list_head *next, *prev;
};
.....

/**
 * list_rotate_to_front() - Rotate list to specific item.
 * @list: The desired new front of the list.
 * @head: The head of the list.
 *
 * Rotates list so that @list becomes the new front of the list.
 */
static inline void list_rotate_to_front(struct list_head *list,
					                    struct list_head *head)
{
	/*
	 * Deletes the list head from the list denoted by @head and
	 * places it as the tail of @list, this effectively rotates the
	 * list so that @list is at the front.
	 */
	list_move_tail(head, list);
}
```

Комментарий отвечает на вопрос "зачем?" через объяснение реализации.

Идеальный вариант это само-документируемый код, когда комментарии внутри кода вообще не требуются. К этому варианту мы стремимся: выверенным кодстайлом, осмысленно-названными переменными и функциями и отсутствием сложных конструкций в коде.

### Документирование кода

[Doxygen](https://www.doxygen.nl/) - cтандарт де факте в индустрии для документирования кода. Он позволяет превратить комментарии в коде, написанные в определенном формате, в полноценную документацию по проекту. Документация может экспортироваться во множество различных форматов, не только в html страницу, хотя является самым распространенным форматом.

У проекта есть множества примеров, которые находятся на этой [странице](https://www.doxygen.nl/examples.html).

Основная информация по стилю комментариев находится [здесь](https://www.doxygen.nl/manual/docblocks.html). Как уже говорилось ранее в семинарах, обычно документируют только публичный интерфейс, который предоставляется пользователю. Обычно его стараются фиксировать, поэтому документацию приходится меня не часто.

Ну и конечно, нельзя было не упомянуть [библиотеку](http://storage.ded32.net.ru/Lib/TX/TXUpdate/Doc/HTML.ru/), с которой многие начинали, её документация также полностью написана с помощью doxygen.

### Рисование блок-схем

Часто для документации приходится рисовать различные схемы, есть удобный [инструмент](https://app.diagrams.net/), который помогает это делать.

<figure>
    <img src="./images/signature_structure.png"
         alt="Пример построенной схемы.">
    <figcaption>Пример построенной схемы.</figcaption>
</figure>


## Самостоятельная работа

1. Изучите синтаксис Markdown и напишите `README.md` к вашему последнему репозиторию: укажите цель проекта, оставьте команды по сборке проекты, напишите краткую документацию с примерами использования.
2. Изучите документацию к `Doxygen` и напишите документацию к основным функциям вашего проекта.
3. Сгенерируйте документацию с помощью `Doxygen`. Проверьте, что вся документация корректно отобразилась на html странице.
