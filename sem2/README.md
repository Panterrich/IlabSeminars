# 2. Git

## Пререквизиты
* [WSL, консоль](../sem1)

## Семинар

Git - это распределённая система контроля версий. Изначально git был разработан Линусом Торвальдсом для написания знакового open source проекта - ядра Linux. Однако сейчас его используют не только для свободного ПО, но и для коммерческой разработки в подавляющем большинстве компаний. Также он полезен и для учебных проектов.

Что же такое система контроля версий и зачем она нужна? В большом проекте часто необходимо иметь возможность откатить изменения, сравнить версии, создать независимые ответвления. Конечно, можно заняться чем-то подобным:

<figure>
    <img src="chaos.png" alt="Хаос. Сотворение мира">
    <figcaption><i>Хаос. Сотворение мира. И.К. Айвазовский, 1841, холст, масло</i></figcaption>
</figure>

Но зачем, когда есть git?

<figure>
    <img src="order.png" alt="Штиль">
    <figcaption><i>Штиль на море. И.К. Айвазовский, 1876, холст, масло</i></figcaption>
</figure>

### Git vs GitHub

Между двумя этими названиями часто возникает путаница. Давайте сразу определимся с понятиями:

- git - система контроля версий, с помощью которой можно создать репозиторий проекта и управлять им

- GitHub - сайт, на который любой желающий может загрузить свои репозитории и поделиться ими со всем миром

Подробнее про GitHub и работу с ним будет рассказано ниже

### Установка git

Для git существует множество графических интерфейсов, но наиболее универсальным и родным для гита способом управления является командная строка.

Ubuntu:
```
sudo apt-get install git
```

После установки нужно задать email и имя пользователя:

```
git config --global user.name "Name"
git config --global user.email "Email"
```

### Создание репозитория

Откроем консоль. Создадим директории нашего проекта и перейдём в неё.

Для создания нового пустого репозитория в данной директории нужно выполнить команду:
```
git init
```

Будет создана скрытая директория `.git`. В ней будет храниться вся необходимая информация, однако просматривать и изменять её не нужно и даже не рекомендуется. Все необходимые действия производятся через разные команды `git`.

### Commit

После создания репозитория можно начать разработку проекта. Например, создать файл с некоторым содержимым. Допустим мы реализовали то, что хотели. Нужно запечатлеть текущее состояние проекта. Для этого существуют коммиты.

Коммит - это некоторая контрольная точка, снимок состояния проекта в конкретный момент времени. Каждый коммит хранит:
- состояние файлов проекта на момент коммита,
- текстовое описание,
- время своего создания,
- автора,
- уникальный хеш (число).

Для создания коммита сначала нужно сообщить гиту, какие именно изменённые или созданные файлы мы хотим учесть в данном коммите. Для этого существует команда:

```
git add file1.txt file2.cpp
```

После можно закоммитить эти изменения:

```
git commit -m "Описание коммита"
```

В описании нужно постараться кратко изложить изменения, которые вносит этот коммит. Например:
- "Добавлена функция solve()"
- "Исправлена ошибка считывания чисел"
- "Реализовано решение уравнений высших степеней"

Эти сообщения в дальнейшем помогут находить нужные версии проекта и сравнивать их между собой, что бывает полезно при отладке и поиске ошибок.

### Загрузка репозитория на github.com

Итак, мы сделали несколько коммитов. Во-первых, хочется защитить проект от, например, случайного удаления - забекапить. Во-вторых, надо же его куда-то выложить, а то никто так и не узнает про него.

Для удалённого хранения репозиториев существует сайт [https://github.com/](https://github.com). Для работы с ним из консоли требуется создать и привязать ssh ключ:

```
ssh-keygen -t ed25519 -C "your_email@example.com"
```

Эта команда спросит о том, куда сохранить файл с ключом. Можно просто нажать `Enter`, тогда он будет сохранён в `~/.ssh/ed25519/`. После можно задать пароль, который будет запрашиваться каждый раз при использовании ключа. Это поле так же можно оставить пустым

После этого надо прикрепить публичную часть ключа к своему аккаунту на GitHub. Выполните команду:

```
cat ~/.ssh/ed25519.pub
```

И скопируйте выведенные символы. Далее зайдите в настройки ключей в GitHub: [https://github.com/settings/keys](https://github.com/settings/keys). Нажмите кнопку `New SSH key`. Вставьте скопированное в поле `Key`. В поле `Title` можно задать заголовок добавленного ключа, например, "Ключ на WSL". После нажмите `Add SSH key`.

Теперь нужно создать новый удалённый репозиторий. Для этого на главной странице нажмите `New`.

![Создание репозитория на GitHub](create_repo.png)

Задайте имя репозитория на английском языке, опционально можно добавить описание. Пока лучше оставить репозиторий публичным. Приватные репозитории доступны только вам и добавленным вами контрибьюторам.

Зайдите на страницу созданного репозитория, нажмите `Code`, выберите вкладку `SSH` и скопируйте url, например, `git@github.com:Panterrich/IlabSeminars.git`.

![Копирование url репозитория](copy_repo_url.png)

Перейдите в консоль и выполните, заменив url на скопированный:

```
git remote add origin git@github.com:Panterrich/IlabSeminars.git
```

Эта команда свяжет ваш локальный репозиторий и удалённый. Теперь можно залить локальные изменения:

```
git push
```

Команду `push` можно делать после каждого изменения (например, коммита).

### Файл `README.md`

Вы можете добавить файл `README.md` в корневую директорию проекта. Этот файл GitHub будет отображать на странице репозитория. В нём используется язык текстовой разметки `Markdown`.

### Файл `.gitignore`

В этот файл можно добавить правила, по которым git будет игнорировать некоторые файлы из директории репозитория. То есть эти файлы не будут учитываться в коммитах. Примеры правил:

```
example.txt             # игнорировать файлы с именем example.txt
/example.txt            # игнорировать файл с именем example.txt в корневой директории
/example/*              # игнорировать все файлы из директории example
*.txt                   # игнорировать все файлы с расширением .txt

example/*               # игнорировать все файлы в директории example
!example/abc/           # кроме тех, что в директории abc
```

Обычно скрывают объектные, исполняемые и другие бинарные файлы. Пример типичного `.gitignore`:

```
/main
/build/*
```

`Makefile` же наоборот скрывать не стоит.

### Файл `.gitattributes`

Для корректного отображения файлов с кириллицей в кодировке `CP1251` можно использовать файл `.gitattributes`. Правила указания файлов схожи с `.gitignore`:

```
/russian.txt working-tree-encoding=CP1251
```

// TODO:
// log, status
// diff
// commit amend
// stash
// pull, fetch
// branch, checkout
// merge, rebase

## Итог

- Что такое **git**?
    - Система контроля версий
- Что такое **репозиторий**?
    - Файлы вашего проекта и история их изменений
- Что такое **GitHub**?
    - Сайт для удалённого хранения ваших репозиториев
- Что такое **коммит**?
    - Снимок состояния проекта, снабжённый описанием
- Что такое **ветка**?
    - Последовательность коммитов
- Что такое
- Зачем это всё нужно?
    - В учёбе:
        - бекап проекта;
        - выявления изменений для исправления случайных ошибок;
        - возможность откатить изменения или создать несколько параллельных версий проекта.
    - В работе:
        - хранение истории проекта;
        - удобство совместной разработки;
        - возможность проверки кода перед принятием в основную ветку;
        - отслеживание и исправление ошибок.
    - В open source:
        - открытость кода, прозрачность, история проекта;
        - возможность создания своих ответвлений, а также внесения улучшений в проект;
        - удобство децентрализованной разработки (часто на добровольной основе).
